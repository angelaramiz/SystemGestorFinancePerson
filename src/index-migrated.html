<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’¼ Sistema Gestor Financiero - VersiÃ³n Migrada ğŸ”„</title>
    
    <!-- ğŸ¨ Estilos principales -->
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/ventanas.css">
    <link rel="stylesheet" href="../css/alertas.css">
    
    <!-- ğŸ“± PWA Manifest -->
    <link rel="manifest" href="../../manifest.json">
    
    <!-- ğŸ¯ Favicon -->
    <link rel="icon" type="image/svg+xml" href="../assets/favicon.svg">
    
    <style>
        /* ğŸ”§ Estilos especÃ­ficos para versiÃ³n migrada */
        .migration-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .system-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }
        
        .status-card h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background-color: #4CAF50; }
        .status-warning { background-color: #FF9800; }
        .status-error { background-color: #F44336; }
        .status-info { background-color: #2196F3; }
        
        .metrics-display {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .dev-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border: 2px solid #667eea;
            z-index: 1000;
        }
        
        .dev-controls button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 12px;
        }
        
        .dev-controls button:hover {
            background: #5a67d8;
        }
    </style>
</head>
<body>
    <!-- ğŸš€ Banner de VersiÃ³n Migrada -->
    <div class="migration-banner">
        ğŸ”„ VERSIÃ“N MIGRADA - Sistema con Arquitectura Refactorizada
        <br><small>Usando DependencyInjector, EventBus, ValidationSystem, MetricsSystem y CacheSystem</small>
    </div>

    <!-- ğŸ® Controles de Desarrollo -->
    <div class="dev-controls">
        <h4 style="margin: 0 0 10px 0; color: #333;">ğŸ› ï¸ Dev Tools</h4>
        <button onclick="initMigratedApp()">ğŸš€ Inicializar App</button>
        <button onclick="showMetrics()">ğŸ“Š Ver MÃ©tricas</button>
        <button onclick="showState()">ğŸ” Ver Estado</button>
        <button onclick="testSystems()">ğŸ§ª Test Sistemas</button>
        <button onclick="clearCache()">ğŸ—‘ï¸ Limpiar CachÃ©</button>
        <button onclick="toggleDebug()">ğŸ› Toggle Debug</button>
    </div>

    <!-- ğŸ“Š Estado de Sistemas -->
    <div class="container">
        <h1>ğŸ’¼ Sistema de GestiÃ³n Financiera Personal</h1>
        <h2>ğŸ”„ VersiÃ³n Migrada con Nuevos Sistemas Core</h2>
        
        <div id="systemStatus" class="system-status">
            <!-- Se llena dinÃ¡micamente -->
        </div>
        
        <div id="metricsDisplay" class="metrics-display" style="display: none;">
            <!-- MÃ©tricas en tiempo real -->
        </div>
        
        <!-- ğŸ“± Interfaz principal de la aplicaciÃ³n -->
        <div id="appContainer">
            <div style="text-align: center; padding: 50px; color: #666;">
                <h3>ğŸš€ Presiona "Inicializar App" para comenzar</h3>
                <p>La aplicaciÃ³n migrada utiliza los nuevos sistemas core para mejor rendimiento y mantenibilidad.</p>
            </div>
        </div>
    </div>

    <!-- ğŸ”§ Scripts del sistema core -->
    <script type="module" src="js/core/DependencyInjector.js"></script>
    <script type="module" src="js/core/EventBus.js"></script>
    <script type="module" src="js/core/ValidationSystem.js"></script>
    <script type="module" src="js/core/MetricsSystem.js"></script>
    <script type="module" src="js/core/CacheSystem.js"></script>
    <script type="module" src="js/modules/logger.js"></script>
    
    <!-- ğŸš€ AplicaciÃ³n migrada -->
    <script type="module" src="js/app-migrated.js"></script>
    
    <!-- ğŸ“Š Scripts de desarrollo y debugging -->
    <script type="module">
        // ğŸ”§ Importar la aplicaciÃ³n migrada
        import GestorFinancieroMigrado from './js/app-migrated.js';
        
        // ğŸŒ Hacer disponible globalmente
        window.GestorFinancieroMigrado = GestorFinancieroMigrado;
        window.migratedApp = null;
        window.debugMode = true;
        
        console.log('âœ… GestorFinancieroMigrado cargado correctamente');
    </script>
    
    <script>
        /**
         * ğŸš€ Inicializar aplicaciÃ³n migrada
         */
        async function initMigratedApp() {
            try {
                updateSystemStatus('app', 'info', 'Inicializando...');
                
                if (!window.GestorFinancieroMigrado) {
                    throw new Error('GestorFinancieroMigrado no estÃ¡ disponible');
                }
                
                window.migratedApp = new window.GestorFinancieroMigrado();
                await window.migratedApp.init();
                
                updateSystemStatus('app', 'success', 'Inicializado correctamente');
                updateAllSystemStatus();
                
                // ğŸ¯ Actualizar interfaz
                document.getElementById('appContainer').innerHTML = `
                    <div style="text-align: center; padding: 30px; background: #e8f5e8; border-radius: 10px;">
                        <h3>âœ… AplicaciÃ³n Migrada Inicializada</h3>
                        <p>Todos los sistemas core estÃ¡n funcionando correctamente.</p>
                        <div style="margin: 20px 0;">
                            <button onclick="showMetrics()" style="margin: 5px;">ğŸ“Š Ver MÃ©tricas</button>
                            <button onclick="showState()" style="margin: 5px;">ğŸ” Ver Estado</button>
                        </div>
                    </div>
                `;
                
                console.log('ğŸ‰ AplicaciÃ³n migrada inicializada correctamente');
                
            } catch (error) {
                updateSystemStatus('app', 'error', `Error: ${error.message}`);
                console.error('âŒ Error inicializando aplicaciÃ³n migrada:', error);
            }
        }
        
        /**
         * ğŸ“Š Mostrar mÃ©tricas del sistema
         */
        function showMetrics() {
            if (!window.migratedApp) {
                alert('ğŸš¨ Primero debes inicializar la aplicaciÃ³n');
                return;
            }
            
            const metrics = window.migratedApp.getMetrics();
            const display = document.getElementById('metricsDisplay');
            
            display.innerHTML = `
                <h3>ğŸ“Š MÃ©tricas del Sistema</h3>
                <pre>${JSON.stringify(metrics, null, 2)}</pre>
            `;
            display.style.display = 'block';
        }
        
        /**
         * ğŸ” Mostrar estado de la aplicaciÃ³n
         */
        function showState() {
            if (!window.migratedApp) {
                alert('ğŸš¨ Primero debes inicializar la aplicaciÃ³n');
                return;
            }
            
            const state = window.migratedApp.getState();
            const display = document.getElementById('metricsDisplay');
            
            display.innerHTML = `
                <h3>ğŸ” Estado de la AplicaciÃ³n</h3>
                <pre>${JSON.stringify(state, null, 2)}</pre>
            `;
            display.style.display = 'block';
        }
        
        /**
         * ğŸ§ª Probar sistemas individualmente
         */
        async function testSystems() {
            if (!window.migratedApp) {
                alert('ğŸš¨ Primero debes inicializar la aplicaciÃ³n');
                return;
            }
            
            const di = window.migratedApp.di;
            
            try {
                // ğŸ§ª Test EventBus
                const eventBus = di.resolve('eventBus');
                eventBus.emit('test:event', { message: 'Test desde dev tools' });
                updateSystemStatus('eventBus', 'success', 'Test exitoso');
                
                // ğŸ§ª Test Cache
                const cache = di.resolve('cache');
                await cache.set('test:key', 'test:value');
                const value = await cache.get('test:key');
                updateSystemStatus('cache', value === 'test:value' ? 'success' : 'error', 
                    value === 'test:value' ? 'Test exitoso' : 'Test fallido');
                
                // ğŸ§ª Test Validation
                const validation = di.resolve('validation');
                const testData = { monto: 100, categoria: 'test' };
                const validated = await validation.validateAndSanitize(testData, 'ingreso');
                updateSystemStatus('validation', 'success', 'Test exitoso');
                
                alert('ğŸ‰ Todos los tests de sistemas completados. Revisa el estado.');
                
            } catch (error) {
                console.error('âŒ Error en tests de sistemas:', error);
                alert('ğŸš¨ Error en tests: ' + error.message);
            }
        }
        
        /**
         * ğŸ—‘ï¸ Limpiar cachÃ© del sistema
         */
        async function clearCache() {
            if (!window.migratedApp) {
                alert('ğŸš¨ Primero debes inicializar la aplicaciÃ³n');
                return;
            }
            
            try {
                const cache = window.migratedApp.di.resolve('cache');
                await cache.clear();
                updateSystemStatus('cache', 'info', 'CachÃ© limpiado');
                alert('ğŸ—‘ï¸ CachÃ© limpiado correctamente');
            } catch (error) {
                console.error('âŒ Error limpiando cachÃ©:', error);
                alert('ğŸš¨ Error limpiando cachÃ©: ' + error.message);
            }
        }
        
        /**
         * ğŸ› Alternar modo debug
         */
        function toggleDebug() {
            window.debugMode = !window.debugMode;
            console.log(`ğŸ› Debug mode: ${window.debugMode ? 'ON' : 'OFF'}`);
            
            if (window.migratedApp) {
                const logger = window.migratedApp.di.resolve('logger');
                logger.setLevel(window.debugMode ? 'debug' : 'info');
            }
            
            updateSystemStatus('debug', window.debugMode ? 'success' : 'warning', 
                window.debugMode ? 'Debug ON' : 'Debug OFF');
        }
        
        /**
         * ğŸ“Š Actualizar estado de un sistema
         */
        function updateSystemStatus(system, status, message) {
            const container = document.getElementById('systemStatus');
            let card = document.getElementById(`status-${system}`);
            
            if (!card) {
                card = document.createElement('div');
                card.className = 'status-card';
                card.id = `status-${system}`;
                container.appendChild(card);
            }
            
            const systemNames = {
                'app': 'ğŸš€ AplicaciÃ³n',
                'eventBus': 'ğŸ“¡ EventBus',
                'cache': 'ğŸ—„ï¸ Cache',
                'validation': 'âœ… Validation',
                'metrics': 'ğŸ“Š Metrics',
                'debug': 'ğŸ› Debug Mode'
            };
            
            card.innerHTML = `
                <h3>${systemNames[system] || system}</h3>
                <div>
                    <span class="status-indicator status-${status}"></span>
                    ${message}
                </div>
                <small style="color: #666;">Actualizado: ${new Date().toLocaleTimeString()}</small>
            `;
        }
        
        /**
         * ğŸ”„ Actualizar estado de todos los sistemas
         */
        function updateAllSystemStatus() {
            updateSystemStatus('eventBus', 'success', 'Sistema de eventos funcionando');
            updateSystemStatus('cache', 'success', 'Sistema de cachÃ© activo');
            updateSystemStatus('validation', 'success', 'Sistema de validaciÃ³n listo');
            updateSystemStatus('metrics', 'success', 'Sistema de mÃ©tricas recopilando');
            updateSystemStatus('debug', window.debugMode ? 'success' : 'warning', 
                window.debugMode ? 'Debug ON' : 'Debug OFF');
        }
        
        // ğŸš€ InicializaciÃ³n automÃ¡tica del estado
        document.addEventListener('DOMContentLoaded', () => {
            updateSystemStatus('app', 'warning', 'No inicializada');
            updateAllSystemStatus();
            
            console.log(`
ğŸ”„ SISTEMA MIGRADO CARGADO
========================

ğŸ› ï¸ Comandos disponibles en consola:
- initMigratedApp()    : Inicializar aplicaciÃ³n
- showMetrics()        : Ver mÃ©tricas
- showState()          : Ver estado
- testSystems()        : Probar sistemas
- clearCache()         : Limpiar cachÃ©
- toggleDebug()        : Toggle debug mode

ğŸ“± Usa los botones del panel de desarrollo en la esquina superior derecha.
            `);
        });
    </script>
</body>
</html>
