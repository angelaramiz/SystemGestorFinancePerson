<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ Demo - Sistema de ConfiguraciÃ³n de Moneda</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/ventanas.css">
    <style>
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .demo-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .demo-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }
        
        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .example-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
        }
        
        .example-card h4 {
            margin: 0 0 0.5rem 0;
            color: #1e293b;
        }
        
        .currency-preview {
            font-size: 1.5rem;
            font-weight: bold;
            color: #059669;
            margin: 0.5rem 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-indicator.success { background: #10b981; }
        .status-indicator.error { background: #ef4444; }
        .status-indicator.warning { background: #f59e0b; }
        
        .log-area {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .config-status {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <!-- Estado del Sistema -->
        <div class="config-status">
            <h1>ğŸ”§ Sistema de ConfiguraciÃ³n de Moneda - Demo</h1>
            <p>Prueba completa del sistema de configuraciÃ³n de moneda del Sistema de GestiÃ³n Financiera Personal</p>
            <div id="system-status">
                <span class="status-indicator warning"></span>Cargando sistema...
            </div>
        </div>

        <!-- Controles Principales -->
        <div class="demo-section">
            <h2>âš™ï¸ Controles del Sistema</h2>
            <div class="demo-buttons">
                <button id="abrir-configuracion" class="btn-primary">
                    ğŸ”§ Abrir ConfiguraciÃ³n
                </button>
                <button id="test-formato" class="btn-secondary">
                    ğŸ’° Probar Formato
                </button>
                <button id="cambiar-usd" class="btn-secondary">
                    ğŸ’µ Cambiar a USD
                </button>
                <button id="cambiar-eur" class="btn-secondary">
                    ğŸ’¶ Cambiar a EUR
                </button>
                <button id="cambiar-mxn" class="btn-secondary">
                    ğŸ‡²ğŸ‡½ Cambiar a MXN
                </button>
                <button id="limpiar-config" class="btn-secondary">
                    ğŸ—‘ï¸ Limpiar ConfiguraciÃ³n
                </button>
            </div>
        </div>

        <!-- Ejemplos de Formato -->
        <div class="demo-section">
            <h2>ğŸ’° Ejemplos de Formato de Moneda</h2>
            <div class="example-grid" id="ejemplos-formato">
                <!-- Se llenarÃ¡n dinÃ¡micamente -->
            </div>
        </div>

        <!-- ConfiguraciÃ³n Actual -->
        <div class="demo-section">
            <h2>ğŸ“Š ConfiguraciÃ³n Actual</h2>
            <div id="config-actual">
                <!-- Se llenarÃ¡ dinÃ¡micamente -->
            </div>
        </div>

        <!-- Log del Sistema -->
        <div class="demo-section">
            <h2>ğŸ“ Log del Sistema</h2>
            <div class="log-area" id="system-log"></div>
        </div>
    </div>

    <!-- Modal de ConfiguraciÃ³n -->
    <div id="modal-configuracion" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>âš™ï¸ ConfiguraciÃ³n del Sistema</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="config-tabs">
                    <button class="config-tab active" data-tab="general">ğŸŒ General</button>
                    <button class="config-tab" data-tab="moneda">ğŸ’° Moneda</button>
                    <button class="config-tab" data-tab="notificaciones">ğŸ”” Notificaciones</button>
                    <button class="config-tab" data-tab="interfaz">ğŸ¨ Interfaz</button>
                    <button class="config-tab" data-tab="datos">ğŸ“Š Datos</button>
                </div>

                <!-- PestaÃ±a General -->
                <div id="config-general" class="config-panel active">
                    <h3>ğŸŒ ConfiguraciÃ³n General</h3>
                    <div class="form-group">
                        <label for="config-idioma">Idioma del Sistema</label>
                        <select id="config-idioma">
                            <option value="es">EspaÃ±ol</option>
                            <option value="en">English</option>
                            <option value="pt">PortuguÃªs</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="config-formato-fecha">Formato de Fecha</label>
                        <select id="config-formato-fecha">
                            <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                            <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                            <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="config-zona-horaria">Zona Horaria</label>
                        <select id="config-zona-horaria">
                            <option value="America/Mexico_City">Ciudad de MÃ©xico (GMT-6)</option>
                            <option value="America/New_York">Nueva York (GMT-5)</option>
                            <option value="Europe/Madrid">Madrid (GMT+1)</option>
                            <option value="America/Sao_Paulo">SÃ£o Paulo (GMT-3)</option>
                        </select>
                    </div>
                </div>

                <!-- PestaÃ±a Moneda -->
                <div id="config-moneda" class="config-panel">
                    <h3>ğŸ’° ConfiguraciÃ³n de Moneda</h3>
                    <div class="form-group">
                        <label for="config-moneda-principal">Moneda Principal</label>
                        <select id="config-moneda-principal">
                            <option value="MXN">ğŸ‡²ğŸ‡½ Peso Mexicano (MXN)</option>
                            <option value="USD">ğŸ‡ºğŸ‡¸ DÃ³lar Estadounidense (USD)</option>
                            <option value="EUR">ğŸ‡ªğŸ‡º Euro (EUR)</option>
                            <option value="GBP">ğŸ‡¬ğŸ‡§ Libra Esterlina (GBP)</option>
                            <option value="JPY">ğŸ‡¯ğŸ‡µ Yen JaponÃ©s (JPY)</option>
                            <option value="CAD">ğŸ‡¨ğŸ‡¦ DÃ³lar Canadiense (CAD)</option>
                            <option value="AUD">ğŸ‡¦ğŸ‡º DÃ³lar Australiano (AUD)</option>
                            <option value="BRL">ğŸ‡§ğŸ‡· Real BrasileÃ±o (BRL)</option>
                            <option value="ARS">ğŸ‡¦ğŸ‡· Peso Argentino (ARS)</option>
                            <option value="COP">ğŸ‡¨ğŸ‡´ Peso Colombiano (COP)</option>
                            <option value="CLP">ğŸ‡¨ğŸ‡± Peso Chileno (CLP)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="config-simbolo-moneda">SÃ­mbolo</label>
                        <input type="text" id="config-simbolo-moneda" placeholder="$" maxlength="3">
                    </div>
                    <div class="form-group">
                        <label for="config-decimales">Decimales</label>
                        <select id="config-decimales">
                            <option value="0">Sin decimales (1000)</option>
                            <option value="2">2 decimales (1000.00)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="config-separador-miles">Separador de Miles</label>
                        <select id="config-separador-miles">
                            <option value=",">,</option>
                            <option value=".">.  </option>
                            <option value=" ">espacio</option>
                            <option value="">ninguno</option>
                        </select>
                    </div>
                    <div class="preview-moneda">
                        <h4>Vista Previa:</h4>
                        <div id="preview-monto">$1,234.56</div>
                    </div>
                </div>

                <!-- PestaÃ±a Notificaciones -->
                <div id="config-notificaciones" class="config-panel">
                    <h3>ğŸ”” ConfiguraciÃ³n de Notificaciones</h3>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="config-notif-habilitadas" checked>
                            Habilitar notificaciones
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="config-notif-anticipacion">DÃ­as de anticipaciÃ³n para vencimientos</label>
                        <select id="config-notif-anticipacion">
                            <option value="1">1 dÃ­a</option>
                            <option value="3" selected>3 dÃ­as</option>
                            <option value="5">5 dÃ­as</option>
                            <option value="7">1 semana</option>
                            <option value="15">15 dÃ­as</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="config-notif-sonido" checked>
                            Reproducir sonido
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="config-notif-browser" checked>
                            Notificaciones del navegador
                        </label>
                    </div>
                </div>

                <!-- PestaÃ±a Interfaz -->
                <div id="config-interfaz" class="config-panel">
                    <h3>ğŸ¨ ConfiguraciÃ³n de Interfaz</h3>
                    <div class="form-group">
                        <label for="config-tema">Tema</label>
                        <select id="config-tema">
                            <option value="claro">ğŸŒ Claro</option>
                            <option value="oscuro">ğŸŒ™ Oscuro</option>
                            <option value="auto">ğŸ”„ AutomÃ¡tico</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="config-color-primario">Color Primario</label>
                        <div class="color-options">
                            <input type="radio" name="color-primario" value="#2563eb" id="color-azul" checked>
                            <label for="color-azul" class="color-option" style="background: #2563eb"></label>
                            <input type="radio" name="color-primario" value="#059669" id="color-verde">
                            <label for="color-verde" class="color-option" style="background: #059669"></label>
                            <input type="radio" name="color-primario" value="#dc2626" id="color-rojo">
                            <label for="color-rojo" class="color-option" style="background: #dc2626"></label>
                            <input type="radio" name="color-primario" value="#7c3aed" id="color-morado">
                            <label for="color-morado" class="color-option" style="background: #7c3aed"></label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="config-animaciones">Animaciones</label>
                        <select id="config-animaciones">
                            <option value="todas">Todas las animaciones</option>
                            <option value="reducidas">Animaciones reducidas</option>
                            <option value="ninguna">Sin animaciones</option>
                        </select>
                    </div>
                </div>

                <!-- PestaÃ±a Datos -->
                <div id="config-datos" class="config-panel">
                    <h3>ğŸ“Š ConfiguraciÃ³n de Datos</h3>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="config-autosave" checked>
                            Autoguardado automÃ¡tico
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="config-autosave-intervalo">Intervalo de autoguardado</label>
                        <select id="config-autosave-intervalo">
                            <option value="1">1 minuto</option>
                            <option value="5" selected>5 minutos</option>
                            <option value="10">10 minutos</option>
                            <option value="30">30 minutos</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="config-backup">Respaldo automÃ¡tico</label>
                        <select id="config-backup">
                            <option value="diario">Diario</option>
                            <option value="semanal" selected>Semanal</option>
                            <option value="mensual">Mensual</option>
                            <option value="manual">Solo manual</option>
                        </select>
                    </div>
                    <div class="data-actions">
                        <button class="btn-secondary" id="btn-limpiar-cache">ğŸ—‘ï¸ Limpiar Cache</button>
                        <button class="btn-secondary" id="btn-reset-config">ğŸ”„ Restaurar ConfiguraciÃ³n</button>
                        <button class="btn-danger" id="btn-borrar-datos">âš ï¸ Borrar Todos los Datos</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary modal-close">Cancelar</button>
                <button class="btn-primary" id="guardar-configuracion">ğŸ’¾ Guardar ConfiguraciÃ³n</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/storage/localStorage.js"></script>
    <script src="js/storage/indexedDB.js"></script>
    <script src="js/models/Ingreso.js"></script>
    <script src="js/models/Gasto.js"></script>
    <script src="js/utils/notificaciones.js"></script>
    <script src="js/utils/configuracion.js"></script>

    <script>
        let isSystemInitialized = false;

        // FunciÃ³n para agregar mensajes al log
        function addLog(message, type = 'info') {
            const logArea = document.getElementById('system-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'success' ? '#10b981' : 
                         type === 'error' ? '#ef4444' : 
                         type === 'warning' ? '#f59e0b' : '#64748b';
            
            logArea.innerHTML += `<div style="color: ${color}; margin-bottom: 0.25rem;">
                [${timestamp}] ${message}
            </div>`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        // FunciÃ³n para actualizar el estado del sistema
        function updateSystemStatus(status, message) {
            const statusEl = document.getElementById('system-status');
            const indicator = statusEl.querySelector('.status-indicator');
            
            indicator.className = `status-indicator ${status}`;
            statusEl.innerHTML = `<span class="status-indicator ${status}"></span>${message}`;
        }

        // FunciÃ³n para actualizar ejemplos de formato
        function updateFormatExamples() {
            const ejemplosDiv = document.getElementById('ejemplos-formato');
            const amounts = [1234.56, 15000, 750000.99, 42, 1000000];
            
            ejemplosDiv.innerHTML = amounts.map(amount => {
                const formatted = window.formatearMoneda ? window.formatearMoneda(amount) : `$${amount}`;
                return `
                    <div class="example-card">
                        <h4>Valor: ${amount}</h4>
                        <div class="currency-preview">${formatted}</div>
                    </div>
                `;
            }).join('');
        }

        // FunciÃ³n para mostrar configuraciÃ³n actual
        function showCurrentConfig() {
            const configDiv = document.getElementById('config-actual');
            const config = window.obtenerConfiguracionMoneda ? window.obtenerConfiguracionMoneda() : {};
            
            configDiv.innerHTML = `
                <div class="example-grid">
                    <div class="example-card">
                        <h4>ğŸ’° Moneda</h4>
                        <p><strong>${config.moneda || 'N/A'}</strong></p>
                    </div>
                    <div class="example-card">
                        <h4>ğŸ”¤ SÃ­mbolo</h4>
                        <p><strong>${config.simbolo || 'N/A'}</strong></p>
                    </div>
                    <div class="example-card">
                        <h4>ğŸ”¢ Decimales</h4>
                        <p><strong>${config.decimales !== undefined ? config.decimales : 'N/A'}</strong></p>
                    </div>
                    <div class="example-card">
                        <h4>ğŸ”— Separador</h4>
                        <p><strong>${config.separadorMiles || 'ninguno'}</strong></p>
                    </div>
                </div>
            `;
        }

        // FunciÃ³n para cambiar configuraciÃ³n rÃ¡pidamente
        async function quickCurrencyChange(currency, symbol) {
            if (!window.ConfiguracionManager) return;

            try {
                // Cambiar configuraciÃ³n directamente
                window.ConfiguracionManager.configuracionActual.monedaPrincipal = currency;
                window.ConfiguracionManager.configuracionActual.simboloMoneda = symbol;
                
                // Guardar y aplicar
                await window.ConfiguracionManager.aplicarConfiguracion();
                
                // Actualizar displays
                updateFormatExamples();
                showCurrentConfig();
                
                addLog(`âœ… Moneda cambiada a ${currency} (${symbol})`, 'success');
            } catch (error) {
                addLog(`âŒ Error al cambiar moneda: ${error.message}`, 'error');
            }
        }

        // InicializaciÃ³n cuando se carga la pÃ¡gina
        document.addEventListener('DOMContentLoaded', async () => {
            addLog('ğŸ”„ Iniciando sistema de configuraciÃ³n...');
            updateSystemStatus('warning', 'Inicializando sistema...');
            
            try {
                // Inicializar managers de almacenamiento
                if (window.localStorageManager) {
                    window.localStorageManager.init();
                    addLog('âœ… LocalStorageManager inicializado', 'success');
                }

                if (window.indexedDBManager) {
                    await window.indexedDBManager.init();
                    addLog('âœ… IndexedDBManager inicializado', 'success');
                }

                // Crear manager de notificaciones
                if (!window.NotificacionesManager) {
                    window.NotificacionesManager = {
                        mostrar: function(mensaje, tipo) {
                            addLog(`ğŸ“¢ ${mensaje}`, tipo);
                        }
                    };
                    addLog('âœ… NotificacionesManager creado', 'success');
                }

                // Inicializar configuraciÃ³n
                if (window.ConfiguracionManager) {
                    await window.ConfiguracionManager.inicializar();
                    addLog('âœ… ConfiguracionManager inicializado', 'success');
                    isSystemInitialized = true;
                    
                    updateSystemStatus('success', 'Sistema completamente inicializado');
                    updateFormatExamples();
                    showCurrentConfig();
                } else {
                    throw new Error('ConfiguracionManager no encontrado');
                }

                // Configurar eventos
                document.getElementById('abrir-configuracion').addEventListener('click', () => {
                    if (window.ConfiguracionManager) {
                        window.ConfiguracionManager.abrirModal();
                        addLog('ğŸ”§ Modal de configuraciÃ³n abierto');
                    }
                });

                document.getElementById('test-formato').addEventListener('click', () => {
                    updateFormatExamples();
                    addLog('ğŸ”„ Ejemplos de formato actualizados');
                });

                document.getElementById('cambiar-usd').addEventListener('click', () => {
                    quickCurrencyChange('USD', '$');
                });

                document.getElementById('cambiar-eur').addEventListener('click', () => {
                    quickCurrencyChange('EUR', 'â‚¬');
                });

                document.getElementById('cambiar-mxn').addEventListener('click', () => {
                    quickCurrencyChange('MXN', '$');
                });

                document.getElementById('limpiar-config').addEventListener('click', async () => {
                    if (confirm('Â¿Limpiar configuraciÃ³n y recargar valores por defecto?')) {
                        localStorage.removeItem('configuracion-sistema');
                        location.reload();
                    }
                });

                // Escuchar cambios en la configuraciÃ³n
                document.addEventListener('configuracion-guardada', () => {
                    updateFormatExamples();
                    showCurrentConfig();
                    addLog('âœ… ConfiguraciÃ³n actualizada', 'success');
                });

                addLog('âœ… Sistema completamente inicializado y listo', 'success');

            } catch (error) {
                addLog(`âŒ Error crÃ­tico: ${error.message}`, 'error');
                updateSystemStatus('error', `Error: ${error.message}`);
                console.error('Error:', error);
            }
        });

        // Actualizar displays cada vez que se guarde configuraciÃ³n
        setInterval(() => {
            if (isSystemInitialized) {
                updateFormatExamples();
                showCurrentConfig();
            }
        }, 5000); // Cada 5 segundos
    </script>
</body>
</html>
