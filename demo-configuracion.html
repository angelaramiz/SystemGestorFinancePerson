<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔧 Demo - Sistema de Configuración de Moneda</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/ventanas.css">
    <style>
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .demo-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .demo-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }
        
        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .example-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
        }
        
        .example-card h4 {
            margin: 0 0 0.5rem 0;
            color: #1e293b;
        }
        
        .currency-preview {
            font-size: 1.5rem;
            font-weight: bold;
            color: #059669;
            margin: 0.5rem 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-indicator.success { background: #10b981; }
        .status-indicator.error { background: #ef4444; }
        .status-indicator.warning { background: #f59e0b; }
        
        .log-area {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .config-status {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <!-- Estado del Sistema -->
        <div class="config-status">
            <h1>🔧 Sistema de Configuración de Moneda - Demo</h1>
            <p>Prueba completa del sistema de configuración de moneda del Sistema de Gestión Financiera Personal</p>
            <div id="system-status">
                <span class="status-indicator warning"></span>Cargando sistema...
            </div>
        </div>

        <!-- Controles Principales -->
        <div class="demo-section">
            <h2>⚙️ Controles del Sistema</h2>
            <div class="demo-buttons">
                <button id="abrir-configuracion" class="btn-primary">
                    🔧 Abrir Configuración
                </button>
                <button id="test-formato" class="btn-secondary">
                    💰 Probar Formato
                </button>
                <button id="cambiar-usd" class="btn-secondary">
                    💵 Cambiar a USD
                </button>
                <button id="cambiar-eur" class="btn-secondary">
                    💶 Cambiar a EUR
                </button>
                <button id="cambiar-mxn" class="btn-secondary">
                    🇲🇽 Cambiar a MXN
                </button>
                <button id="limpiar-config" class="btn-secondary">
                    🗑️ Limpiar Configuración
                </button>
            </div>
        </div>

        <!-- Ejemplos de Formato -->
        <div class="demo-section">
            <h2>💰 Ejemplos de Formato de Moneda</h2>
            <div class="example-grid" id="ejemplos-formato">
                <!-- Se llenarán dinámicamente -->
            </div>
        </div>

        <!-- Configuración Actual -->
        <div class="demo-section">
            <h2>📊 Configuración Actual</h2>
            <div id="config-actual">
                <!-- Se llenará dinámicamente -->
            </div>
        </div>

        <!-- Log del Sistema -->
        <div class="demo-section">
            <h2>📝 Log del Sistema</h2>
            <div class="log-area" id="system-log"></div>
        </div>
    </div>

    <!-- Modal de Configuración -->
    <div id="modal-configuracion" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>⚙️ Configuración del Sistema</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="config-tabs">
                    <button class="config-tab active" data-tab="general">🌐 General</button>
                    <button class="config-tab" data-tab="moneda">💰 Moneda</button>
                    <button class="config-tab" data-tab="notificaciones">🔔 Notificaciones</button>
                    <button class="config-tab" data-tab="interfaz">🎨 Interfaz</button>
                    <button class="config-tab" data-tab="datos">📊 Datos</button>
                </div>

                <!-- Pestaña General -->
                <div id="config-general" class="config-panel active">
                    <h3>🌐 Configuración General</h3>
                    <div class="form-group">
                        <label for="config-idioma">Idioma del Sistema</label>
                        <select id="config-idioma">
                            <option value="es">Español</option>
                            <option value="en">English</option>
                            <option value="pt">Português</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="config-formato-fecha">Formato de Fecha</label>
                        <select id="config-formato-fecha">
                            <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                            <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                            <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="config-zona-horaria">Zona Horaria</label>
                        <select id="config-zona-horaria">
                            <option value="America/Mexico_City">Ciudad de México (GMT-6)</option>
                            <option value="America/New_York">Nueva York (GMT-5)</option>
                            <option value="Europe/Madrid">Madrid (GMT+1)</option>
                            <option value="America/Sao_Paulo">São Paulo (GMT-3)</option>
                        </select>
                    </div>
                </div>

                <!-- Pestaña Moneda -->
                <div id="config-moneda" class="config-panel">
                    <h3>💰 Configuración de Moneda</h3>
                    <div class="form-group">
                        <label for="config-moneda-principal">Moneda Principal</label>
                        <select id="config-moneda-principal">
                            <option value="MXN">🇲🇽 Peso Mexicano (MXN)</option>
                            <option value="USD">🇺🇸 Dólar Estadounidense (USD)</option>
                            <option value="EUR">🇪🇺 Euro (EUR)</option>
                            <option value="GBP">🇬🇧 Libra Esterlina (GBP)</option>
                            <option value="JPY">🇯🇵 Yen Japonés (JPY)</option>
                            <option value="CAD">🇨🇦 Dólar Canadiense (CAD)</option>
                            <option value="AUD">🇦🇺 Dólar Australiano (AUD)</option>
                            <option value="BRL">🇧🇷 Real Brasileño (BRL)</option>
                            <option value="ARS">🇦🇷 Peso Argentino (ARS)</option>
                            <option value="COP">🇨🇴 Peso Colombiano (COP)</option>
                            <option value="CLP">🇨🇱 Peso Chileno (CLP)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="config-simbolo-moneda">Símbolo</label>
                        <input type="text" id="config-simbolo-moneda" placeholder="$" maxlength="3">
                    </div>
                    <div class="form-group">
                        <label for="config-decimales">Decimales</label>
                        <select id="config-decimales">
                            <option value="0">Sin decimales (1000)</option>
                            <option value="2">2 decimales (1000.00)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="config-separador-miles">Separador de Miles</label>
                        <select id="config-separador-miles">
                            <option value=",">,</option>
                            <option value=".">.  </option>
                            <option value=" ">espacio</option>
                            <option value="">ninguno</option>
                        </select>
                    </div>
                    <div class="preview-moneda">
                        <h4>Vista Previa:</h4>
                        <div id="preview-monto">$1,234.56</div>
                    </div>
                </div>

                <!-- Pestaña Notificaciones -->
                <div id="config-notificaciones" class="config-panel">
                    <h3>🔔 Configuración de Notificaciones</h3>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="config-notif-habilitadas" checked>
                            Habilitar notificaciones
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="config-notif-anticipacion">Días de anticipación para vencimientos</label>
                        <select id="config-notif-anticipacion">
                            <option value="1">1 día</option>
                            <option value="3" selected>3 días</option>
                            <option value="5">5 días</option>
                            <option value="7">1 semana</option>
                            <option value="15">15 días</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="config-notif-sonido" checked>
                            Reproducir sonido
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="config-notif-browser" checked>
                            Notificaciones del navegador
                        </label>
                    </div>
                </div>

                <!-- Pestaña Interfaz -->
                <div id="config-interfaz" class="config-panel">
                    <h3>🎨 Configuración de Interfaz</h3>
                    <div class="form-group">
                        <label for="config-tema">Tema</label>
                        <select id="config-tema">
                            <option value="claro">🌞 Claro</option>
                            <option value="oscuro">🌙 Oscuro</option>
                            <option value="auto">🔄 Automático</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="config-color-primario">Color Primario</label>
                        <div class="color-options">
                            <input type="radio" name="color-primario" value="#2563eb" id="color-azul" checked>
                            <label for="color-azul" class="color-option" style="background: #2563eb"></label>
                            <input type="radio" name="color-primario" value="#059669" id="color-verde">
                            <label for="color-verde" class="color-option" style="background: #059669"></label>
                            <input type="radio" name="color-primario" value="#dc2626" id="color-rojo">
                            <label for="color-rojo" class="color-option" style="background: #dc2626"></label>
                            <input type="radio" name="color-primario" value="#7c3aed" id="color-morado">
                            <label for="color-morado" class="color-option" style="background: #7c3aed"></label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="config-animaciones">Animaciones</label>
                        <select id="config-animaciones">
                            <option value="todas">Todas las animaciones</option>
                            <option value="reducidas">Animaciones reducidas</option>
                            <option value="ninguna">Sin animaciones</option>
                        </select>
                    </div>
                </div>

                <!-- Pestaña Datos -->
                <div id="config-datos" class="config-panel">
                    <h3>📊 Configuración de Datos</h3>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="config-autosave" checked>
                            Autoguardado automático
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="config-autosave-intervalo">Intervalo de autoguardado</label>
                        <select id="config-autosave-intervalo">
                            <option value="1">1 minuto</option>
                            <option value="5" selected>5 minutos</option>
                            <option value="10">10 minutos</option>
                            <option value="30">30 minutos</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="config-backup">Respaldo automático</label>
                        <select id="config-backup">
                            <option value="diario">Diario</option>
                            <option value="semanal" selected>Semanal</option>
                            <option value="mensual">Mensual</option>
                            <option value="manual">Solo manual</option>
                        </select>
                    </div>
                    <div class="data-actions">
                        <button class="btn-secondary" id="btn-limpiar-cache">🗑️ Limpiar Cache</button>
                        <button class="btn-secondary" id="btn-reset-config">🔄 Restaurar Configuración</button>
                        <button class="btn-danger" id="btn-borrar-datos">⚠️ Borrar Todos los Datos</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary modal-close">Cancelar</button>
                <button class="btn-primary" id="guardar-configuracion">💾 Guardar Configuración</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/storage/localStorage.js"></script>
    <script src="js/storage/indexedDB.js"></script>
    <script src="js/models/Ingreso.js"></script>
    <script src="js/models/Gasto.js"></script>
    <script src="js/utils/notificaciones.js"></script>
    <script src="js/utils/configuracion.js"></script>

    <script>
        let isSystemInitialized = false;

        // Función para agregar mensajes al log
        function addLog(message, type = 'info') {
            const logArea = document.getElementById('system-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'success' ? '#10b981' : 
                         type === 'error' ? '#ef4444' : 
                         type === 'warning' ? '#f59e0b' : '#64748b';
            
            logArea.innerHTML += `<div style="color: ${color}; margin-bottom: 0.25rem;">
                [${timestamp}] ${message}
            </div>`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        // Función para actualizar el estado del sistema
        function updateSystemStatus(status, message) {
            const statusEl = document.getElementById('system-status');
            const indicator = statusEl.querySelector('.status-indicator');
            
            indicator.className = `status-indicator ${status}`;
            statusEl.innerHTML = `<span class="status-indicator ${status}"></span>${message}`;
        }

        // Función para actualizar ejemplos de formato
        function updateFormatExamples() {
            const ejemplosDiv = document.getElementById('ejemplos-formato');
            const amounts = [1234.56, 15000, 750000.99, 42, 1000000];
            
            ejemplosDiv.innerHTML = amounts.map(amount => {
                const formatted = window.formatearMoneda ? window.formatearMoneda(amount) : `$${amount}`;
                return `
                    <div class="example-card">
                        <h4>Valor: ${amount}</h4>
                        <div class="currency-preview">${formatted}</div>
                    </div>
                `;
            }).join('');
        }

        // Función para mostrar configuración actual
        function showCurrentConfig() {
            const configDiv = document.getElementById('config-actual');
            const config = window.obtenerConfiguracionMoneda ? window.obtenerConfiguracionMoneda() : {};
            
            configDiv.innerHTML = `
                <div class="example-grid">
                    <div class="example-card">
                        <h4>💰 Moneda</h4>
                        <p><strong>${config.moneda || 'N/A'}</strong></p>
                    </div>
                    <div class="example-card">
                        <h4>🔤 Símbolo</h4>
                        <p><strong>${config.simbolo || 'N/A'}</strong></p>
                    </div>
                    <div class="example-card">
                        <h4>🔢 Decimales</h4>
                        <p><strong>${config.decimales !== undefined ? config.decimales : 'N/A'}</strong></p>
                    </div>
                    <div class="example-card">
                        <h4>🔗 Separador</h4>
                        <p><strong>${config.separadorMiles || 'ninguno'}</strong></p>
                    </div>
                </div>
            `;
        }

        // Función para cambiar configuración rápidamente
        async function quickCurrencyChange(currency, symbol) {
            if (!window.ConfiguracionManager) return;

            try {
                // Cambiar configuración directamente
                window.ConfiguracionManager.configuracionActual.monedaPrincipal = currency;
                window.ConfiguracionManager.configuracionActual.simboloMoneda = symbol;
                
                // Guardar y aplicar
                await window.ConfiguracionManager.aplicarConfiguracion();
                
                // Actualizar displays
                updateFormatExamples();
                showCurrentConfig();
                
                addLog(`✅ Moneda cambiada a ${currency} (${symbol})`, 'success');
            } catch (error) {
                addLog(`❌ Error al cambiar moneda: ${error.message}`, 'error');
            }
        }

        // Inicialización cuando se carga la página
        document.addEventListener('DOMContentLoaded', async () => {
            addLog('🔄 Iniciando sistema de configuración...');
            updateSystemStatus('warning', 'Inicializando sistema...');
            
            try {
                // Inicializar managers de almacenamiento
                if (window.localStorageManager) {
                    window.localStorageManager.init();
                    addLog('✅ LocalStorageManager inicializado', 'success');
                }

                if (window.indexedDBManager) {
                    await window.indexedDBManager.init();
                    addLog('✅ IndexedDBManager inicializado', 'success');
                }

                // Crear manager de notificaciones
                if (!window.NotificacionesManager) {
                    window.NotificacionesManager = {
                        mostrar: function(mensaje, tipo) {
                            addLog(`📢 ${mensaje}`, tipo);
                        }
                    };
                    addLog('✅ NotificacionesManager creado', 'success');
                }

                // Inicializar configuración
                if (window.ConfiguracionManager) {
                    await window.ConfiguracionManager.inicializar();
                    addLog('✅ ConfiguracionManager inicializado', 'success');
                    isSystemInitialized = true;
                    
                    updateSystemStatus('success', 'Sistema completamente inicializado');
                    updateFormatExamples();
                    showCurrentConfig();
                } else {
                    throw new Error('ConfiguracionManager no encontrado');
                }

                // Configurar eventos
                document.getElementById('abrir-configuracion').addEventListener('click', () => {
                    if (window.ConfiguracionManager) {
                        window.ConfiguracionManager.abrirModal();
                        addLog('🔧 Modal de configuración abierto');
                    }
                });

                document.getElementById('test-formato').addEventListener('click', () => {
                    updateFormatExamples();
                    addLog('🔄 Ejemplos de formato actualizados');
                });

                document.getElementById('cambiar-usd').addEventListener('click', () => {
                    quickCurrencyChange('USD', '$');
                });

                document.getElementById('cambiar-eur').addEventListener('click', () => {
                    quickCurrencyChange('EUR', '€');
                });

                document.getElementById('cambiar-mxn').addEventListener('click', () => {
                    quickCurrencyChange('MXN', '$');
                });

                document.getElementById('limpiar-config').addEventListener('click', async () => {
                    if (confirm('¿Limpiar configuración y recargar valores por defecto?')) {
                        localStorage.removeItem('configuracion-sistema');
                        location.reload();
                    }
                });

                // Escuchar cambios en la configuración
                document.addEventListener('configuracion-guardada', () => {
                    updateFormatExamples();
                    showCurrentConfig();
                    addLog('✅ Configuración actualizada', 'success');
                });

                addLog('✅ Sistema completamente inicializado y listo', 'success');

            } catch (error) {
                addLog(`❌ Error crítico: ${error.message}`, 'error');
                updateSystemStatus('error', `Error: ${error.message}`);
                console.error('Error:', error);
            }
        });

        // Actualizar displays cada vez que se guarde configuración
        setInterval(() => {
            if (isSystemInitialized) {
                updateFormatExamples();
                showCurrentConfig();
            }
        }, 5000); // Cada 5 segundos
    </script>
</body>
</html>
