<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pruebas Simplificadas - Sistema Financiero</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 5px;
            font-size: 14px;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .results {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .console {
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 15px;
        }
        
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß™ Pruebas del Sistema Financiero</h1>
        <p>Versi√≥n Simplificada</p>
    </div>
    
    <div style="text-align: center;">
        <button class="btn btn-primary" onclick="ejecutarPruebas()">
            üöÄ Ejecutar Todas las Pruebas
        </button>
        <button class="btn btn-primary" onclick="limpiarConsola()">
            üßπ Limpiar Consola
        </button>
    </div>
    
    <div class="results">
        <h3>üìä Resultados de las Pruebas</h3>
        <div id="estadisticas"></div>
        <div class="console" id="console-output"></div>
    </div>

    <!-- Incluir archivos de prueba -->
    <script src="test-utils.js"></script>
    <script src="test-storage.js"></script>
    <script src="test-models.js"></script>
    <script src="test-algorithm.js"></script>

    <script>
        const consoleElement = document.getElementById('console-output');
        const estadisticasElement = document.getElementById('estadisticas');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            consoleElement.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            consoleElement.scrollTop = consoleElement.scrollHeight;
        }
        
        function limpiarConsola() {
            consoleElement.innerHTML = '';
            estadisticasElement.innerHTML = '';
        }
        
        function actualizarEstadisticas(resultados) {
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">';
            
            Object.entries(resultados).forEach(([categoria, resultado]) => {
                const porcentaje = resultado.porcentaje || 0;
                const color = porcentaje === 100 ? '#28a745' : porcentaje >= 80 ? '#ffc107' : '#dc3545';
                
                html += `
                    <div style="background: ${color}; color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <h4 style="margin: 0 0 10px 0;">${categoria.toUpperCase()}</h4>
                        <div style="font-size: 24px; font-weight: bold;">${resultado.exitosos}/${resultado.total}</div>
                        <div style="font-size: 14px;">${porcentaje.toFixed(1)}%</div>
                    </div>
                `;
            });
            
            html += '</div>';
            estadisticasElement.innerHTML = html;
        }
        
        function ejecutarPruebas() {
            limpiarConsola();
            log('üöÄ === INICIANDO PRUEBAS DEL SISTEMA ===', 'info');
            log('Fecha: ' + new Date().toLocaleString(), 'info');
            log('=' .repeat(50), 'info');
            
            const resultados = {};
            let totalPruebas = 0;
            let totalExitosas = 0;
            
            // Ejecutar pruebas de almacenamiento
            try {
                log('\n1Ô∏è‚É£ Ejecutando pruebas de almacenamiento...', 'info');
                if (typeof ejecutarPruebasAlmacenamiento === 'function') {
                    resultados.almacenamiento = ejecutarPruebasAlmacenamiento();
                    totalPruebas += resultados.almacenamiento.total;
                    totalExitosas += resultados.almacenamiento.exitosos;
                    log(`‚úÖ Almacenamiento: ${resultados.almacenamiento.exitosos}/${resultados.almacenamiento.total} (${resultados.almacenamiento.porcentaje.toFixed(1)}%)`, 'success');
                } else {
                    log('‚ùå Funci√≥n ejecutarPruebasAlmacenamiento no encontrada', 'error');
                    resultados.almacenamiento = { exitosos: 0, total: 0, porcentaje: 0 };
                }
            } catch (error) {
                log(`‚ùå Error en pruebas de almacenamiento: ${error.message}`, 'error');
                resultados.almacenamiento = { exitosos: 0, total: 0, porcentaje: 0, error: error.message };
            }
            
            // Ejecutar pruebas de modelos
            try {
                log('\n2Ô∏è‚É£ Ejecutando pruebas de modelos...', 'info');
                if (typeof ejecutarPruebasModelos === 'function') {
                    resultados.modelos = ejecutarPruebasModelos();
                    totalPruebas += resultados.modelos.total;
                    totalExitosas += resultados.modelos.exitosos;
                    log(`‚úÖ Modelos: ${resultados.modelos.exitosos}/${resultados.modelos.total} (${resultados.modelos.porcentaje.toFixed(1)}%)`, 'success');
                } else {
                    log('‚ùå Funci√≥n ejecutarPruebasModelos no encontrada', 'error');
                    resultados.modelos = { exitosos: 0, total: 0, porcentaje: 0 };
                }
            } catch (error) {
                log(`‚ùå Error en pruebas de modelos: ${error.message}`, 'error');
                resultados.modelos = { exitosos: 0, total: 0, porcentaje: 0, error: error.message };
            }
            
            // Ejecutar pruebas de algoritmos
            try {
                log('\n3Ô∏è‚É£ Ejecutando pruebas de algoritmos...', 'info');
                if (typeof ejecutarPruebasAlgoritmo === 'function') {
                    resultados.algoritmos = ejecutarPruebasAlgoritmo();
                    totalPruebas += resultados.algoritmos.total;
                    totalExitosas += resultados.algoritmos.exitosos;
                    log(`‚úÖ Algoritmos: ${resultados.algoritmos.exitosos}/${resultados.algoritmos.total} (${resultados.algoritmos.porcentaje.toFixed(1)}%)`, 'success');
                } else {
                    log('‚ùå Funci√≥n ejecutarPruebasAlgoritmo no encontrada', 'error');
                    resultados.algoritmos = { exitosos: 0, total: 0, porcentaje: 0 };
                }
            } catch (error) {
                log(`‚ùå Error en pruebas de algoritmos: ${error.message}`, 'error');
                resultados.algoritmos = { exitosos: 0, total: 0, porcentaje: 0, error: error.message };
            }
            
            // Mostrar resumen final
            const porcentajeGeneral = totalPruebas > 0 ? (totalExitosas / totalPruebas) * 100 : 0;
            
            log('\n' + '=' .repeat(50), 'info');
            log('üìã === RESUMEN FINAL ===', 'info');
            log('=' .repeat(50), 'info');
            log(`üéØ Pruebas exitosas: ${totalExitosas}/${totalPruebas}`, porcentajeGeneral === 100 ? 'success' : 'warning');
            log(`üìä Porcentaje general: ${porcentajeGeneral.toFixed(1)}%`, porcentajeGeneral === 100 ? 'success' : 'warning');
            
            if (porcentajeGeneral === 100) {
                log('üéâ ¬°Todas las pruebas pasaron exitosamente!', 'success');
            } else if (porcentajeGeneral >= 80) {
                log('‚ö†Ô∏è Mayor√≠a de pruebas exitosas, revisar fallos menores', 'warning');
            } else {
                log('‚ùå M√∫ltiples fallos detectados, revisar el sistema', 'error');
            }
            
            // Actualizar estad√≠sticas visuales
            actualizarEstadisticas(resultados);
        }
        
        // Interceptar console.log para mostrar en la interfaz
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(message) {
            originalLog(message);
            if (typeof message === 'string') {
                log(message, 'info');
            }
        };
        
        console.error = function(message) {
            originalError(message);
            if (typeof message === 'string') {
                log(message, 'error');
            }
        };
    </script>
</body>
</html>
